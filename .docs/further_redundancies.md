# Further Redundancies Identified

| Legacy Item | Current Usage | Replacement / Modern Path |
| --- | --- | --- |
| `_normalize_currency_amount` helper | Still wraps cent and rounding conversions inside event push payload normalisation, despite the dedicated currency utilities. It is invoked when compacting `portfolio_values` and `portfolio_positions` events. 【F:custom_components/pp_reader/data/event_push.py†L40-L120】 | Replace direct calls with the shared helpers from `util.currency` (e.g. `cent_to_eur`, `round_currency`) per the cleanup plan to remove redundant wrappers. 【F:.docs/TODO_redundancy_cleanup_plan.md†L22-L25】 |
| `_normalize_position_entry` event payload builder | Continues to recompute purchase totals, average prices, and gain metrics with local coercion logic instead of reusing the `aggregation`/`average_cost` output the backend now provides. 【F:custom_components/pp_reader/data/event_push.py†L160-L276】 | Read the precomputed fields from `aggregation` and `average_cost` directly, aligning with the new holdings helpers and Average-Cost selection flow. 【F:.docs/TODO_redundancy_cleanup_plan.md†L142-L166】 |
| `_normalize_amount` (and `_portfolio_contract_entry`) | Coordinator still divides by 100 and rounds ad-hoc when mapping live portfolio rows, recreating logic that the currency utilities and holdings aggregation already cover. 【F:custom_components/pp_reader/data/coordinator.py†L80-L165】 | Use `cent_to_eur`/`round_currency` for conversions and lean on the shared aggregation helpers to eliminate the bespoke normaliser. 【F:.docs/TODO_redundancy_cleanup_plan.md†L7-L25】【F:.docs/TODO_redundancy_cleanup_plan.md†L85-L123】 |
| `_coerce_float` & `_coerce_optional_float` in WebSocket serializer | WebSocket payloads still run through bespoke float coercion and rounding, duplicating the behaviour of the new currency helpers and average cost pipeline. 【F:custom_components/pp_reader/data/websocket.py†L140-L270】 | Replace with the shared rounding helpers and pass through the average cost payload untouched, as outlined for the WebSocket refactor. 【F:.docs/TODO_redundancy_cleanup_plan.md†L152-L160】 |
| `_normalize_portfolio_positions` (WebSocket) | Recomputes purchase totals, average prices, and performance metrics on the fly instead of trusting the backend aggregation/average-cost values. 【F:custom_components/pp_reader/data/websocket.py†L272-L359】 | Serialize the provided `aggregation`/`average_cost` objects directly to match the planned Average-Cost WebSocket simplification. 【F:.docs/TODO_redundancy_cleanup_plan.md†L152-L160】 |
| `calculate_account_balance` cent division | Accounting logic still converts cents to EUR via `/ 100.0`, bypassing the shared helper meant to centralise currency conversions. 【F:custom_components/pp_reader/logic/accounting.py†L14-L72】 | Switch to `cent_to_eur` (and `round_currency` where needed) per the backend utility migration. 【F:.docs/TODO_redundancy_cleanup_plan.md†L7-L20】 |
| `_normalize_transaction_amounts` in securities logic | Transaction normalisation divides by 100 for gross amounts, fees, and taxes, duplicating the cent conversion helper introduced in the utilities module. 【F:custom_components/pp_reader/logic/securities.py†L98-L159】 | Use `cent_to_eur`/`round_currency` for cent-to-EUR conversion to align with the shared helper strategy. 【F:.docs/TODO_redundancy_cleanup_plan.md†L7-L20】 |
| Account balance scaling in `sync_from_pclient` | Legacy sync still divides raw balances by 100 when constructing updated account payloads. 【F:custom_components/pp_reader/data/sync_from_pclient.py†L1148-L1174】 | Apply the central currency helpers so the sync path mirrors the normalised conversions elsewhere. 【F:.docs/TODO_redundancy_cleanup_plan.md†L7-L35】 |
