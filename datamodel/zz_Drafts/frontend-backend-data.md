# Frontend–Backend Data Expectations

This document catalogues every backend payload field that the Portfolio Performance Reader frontend consumes. For each field the table lists the websocket command or push event that delivers it, the module initiating the request, where the data is normalised, and where it ends up in the UI.

## Account summaries (`pp_reader/get_accounts` command, `accounts` push)

| Name | Format | Requested by | Processed in | Displayed in | Description |
| --- | --- | --- | --- | --- | --- |
| `name` | string (account label) | `src/tabs/overview.ts` – `renderDashboard()` | `src/tabs/overview.ts` – `renderDashboard()`; `src/data/updateConfigsWS.ts` – `handleAccountUpdate()` | `src/tabs/overview.ts` – liquidity cards; `src/data/updateConfigsWS.ts` – `updateAccountTable()` | Account name shown in the EUR and FX account tables and refreshed on push updates.【F:src/tabs/overview.ts†L1317-L1343】【F:src/data/updateConfigsWS.ts†L330-L423】 |
| `balance` | number (EUR total, nullable when FX missing) | `src/tabs/overview.ts` – `renderDashboard()` | `src/tabs/overview.ts` – `renderDashboard()`; `src/data/updateConfigsWS.ts` – `handleAccountUpdate()` and `updateTotalWealth()` | Account tables and the total wealth header output | Current account value in EUR used for table cells and the overall wealth calculation.【F:src/tabs/overview.ts†L1317-L1403】【F:src/data/updateConfigsWS.ts†L330-L384】【F:src/data/updateConfigsWS.ts†L1042-L1078】 |
| `currency_code` | string (ISO 4217 or symbol) | `src/tabs/overview.ts` – `renderDashboard()` | `src/tabs/overview.ts` – `renderDashboard()`; `src/data/updateConfigsWS.ts` – `handleAccountUpdate()` | FX account table grouping and warning banner | Currency identifier used to split EUR vs. FX accounts and render original currency hints when exchange rates are available.【F:src/tabs/overview.ts†L1317-L1343】【F:src/tabs/overview.ts†L1430-L1472】【F:src/data/updateConfigsWS.ts†L370-L421】 |
| `orig_balance` | number (account currency amount) | `src/tabs/overview.ts` – `renderDashboard()` | `src/data/updateConfigsWS.ts` – `handleAccountUpdate()` | FX account table | Native-currency balance formatted in the FX account table alongside the EUR conversion.【F:src/tabs/overview.ts†L1317-L1343】【F:src/data/updateConfigsWS.ts†L390-L418】 |
| `fx_unavailable` | boolean | `src/tabs/overview.ts` – `renderDashboard()` | `src/tabs/overview.ts` – `renderDashboard()`; `src/data/updateConfigsWS.ts` – `handlePortfolioUpdate()` via table totals | Header warning and total wealth fallback markup | Flag indicating missing FX data; drives warning copy and suppresses totals when rates are absent.【F:src/tabs/overview.ts†L1331-L1403】【F:src/data/updateConfigsWS.ts†L557-L590】 |

## Portfolio summaries (`pp_reader/get_portfolio_data` command, `portfolio_values` push)

| Name | Format | Requested by | Processed in | Displayed in | Description |
| --- | --- | --- | --- | --- | --- |
| `uuid` | string (portfolio identifier) | `src/tabs/overview.ts` – `renderDashboard()` | `src/tabs/overview.ts` – `renderDashboard()`; `src/data/updateConfigsWS.ts` – `handlePortfolioUpdate()` | Portfolio table rows and data attributes | Primary key used to link summary rows, lazy-loaded positions, and push updates.【F:src/tabs/overview.ts†L1345-L1382】【F:src/data/updateConfigsWS.ts†L430-L600】 |
| `name` | string | `src/tabs/overview.ts` – `renderDashboard()` | `src/tabs/overview.ts` – `renderDashboard()` | Portfolio summary table | Portfolio display name rendered in the expandable investment table.【F:src/tabs/overview.ts†L1345-L1382】 |
| `position_count` / `count` | number | `src/tabs/overview.ts` – `renderDashboard()` | `src/data/updateConfigsWS.ts` – `handlePortfolioUpdate()` | Portfolio summary table | Number of holdings in the portfolio, shown in the second column and refreshed via push events.【F:src/tabs/overview.ts†L1345-L1382】【F:src/data/updateConfigsWS.ts†L539-L599】 |
| `current_value` / `value` | number (EUR) | `src/tabs/overview.ts` – `renderDashboard()` | `src/tabs/overview.ts` – `renderDashboard()`; `src/data/updateConfigsWS.ts` – `handlePortfolioUpdate()` | Portfolio summary table and total wealth footer | Portfolio market value in EUR used for table cells, dataset attributes, and overall wealth totals.【F:src/tabs/overview.ts†L1345-L1403】【F:src/data/updateConfigsWS.ts†L539-L665】 |
| `purchase_sum` / `purchaseSum` | number (EUR cost basis) | `src/tabs/overview.ts` – `renderDashboard()` | `src/data/updateConfigsWS.ts` – `handlePortfolioUpdate()` | Hidden dataset values for footer recomputation | Purchase total leveraged when recalculating footer sums and percentage gains.【F:src/tabs/overview.ts†L1345-L1382】【F:src/data/updateConfigsWS.ts†L546-L665】 |
| `missing_value_positions` | number | `src/tabs/overview.ts` – `renderDashboard()` | `src/tabs/overview.ts` – `renderDashboard()` | Portfolio summary table (FX warning handling) | Count of positions lacking valuation; used to flag partial totals and FX availability.【F:src/tabs/overview.ts†L1345-L1382】 |
| `fx_unavailable` | boolean (derived from missing data) | `src/tabs/overview.ts` – `renderDashboard()` | `src/tabs/overview.ts` – `renderDashboard()`; `src/data/updateConfigsWS.ts` – `handlePortfolioUpdate()` | Portfolio summary table styling and wealth banner | Marks portfolios with incomplete EUR valuations to add warning notes and suppress totals.【F:src/tabs/overview.ts†L1345-L1403】【F:src/data/updateConfigsWS.ts†L557-L590】 |
| `performance.gain_abs` | number (EUR gain) | `src/tabs/overview.ts` – `renderDashboard()` | `src/tabs/overview.ts` – `renderDashboard()`; `src/data/updateConfigsWS.ts` – `handlePortfolioUpdate()`; `src/content/elements.ts` – `formatValue()` | Portfolio table gain column | Absolute gain shown per portfolio row and recomputed during push updates.【F:src/tabs/overview.ts†L1356-L1380】【F:src/data/updateConfigsWS.ts†L539-L599】【F:src/content/elements.ts†L47-L84】 |
| `performance.gain_pct` | number (% gain) | Same as above | Same as above | Portfolio table percentage column | Percentage gain rendered beside absolute gain with colour coding.【F:src/tabs/overview.ts†L1356-L1380】【F:src/data/updateConfigsWS.ts†L539-L589】【F:src/content/elements.ts†L47-L84】 |

## Portfolio positions (`pp_reader/get_portfolio_positions` command, `portfolio_positions` push)

| Name | Format | Requested by | Processed in | Displayed in | Description |
| --- | --- | --- | --- | --- | --- |
| `portfolio_uuid` / `portfolioUuid` | string | `src/tabs/overview.ts` – `attachPortfolioToggleHandler()` | `src/data/updateConfigsWS.ts` – `handlePortfolioPositionsUpdate()` | Toggle detail rows | Identifies which portfolio’s positions payload applies to when lazily loaded or pushed.【F:src/tabs/overview.ts†L1120-L1268】【F:src/data/updateConfigsWS.ts†L676-L752】 |
| `positions` | array of position objects | `src/tabs/overview.ts` – `attachPortfolioToggleHandler()` | `src/data/updateConfigsWS.ts` – `handlePortfolioPositionsUpdate()`; `sanitizePositions()` | Expandable positions tables | Collection of holdings rendered when a portfolio is expanded.【F:src/tabs/overview.ts†L1120-L1268】【F:src/data/updateConfigsWS.ts†L691-L753】 |
| `error` | string (optional) | `src/tabs/overview.ts` – `attachPortfolioToggleHandler()` | `src/data/updateConfigsWS.ts` – `handlePortfolioPositionsUpdate()`; `applyPortfolioPositionsToDom()` | Error banner inside positions container | Backend error message displayed instead of the positions table when retrieval fails.【F:src/tabs/overview.ts†L1226-L1258】【F:src/data/updateConfigsWS.ts†L701-L258】 |
| `positions[].security_uuid` | string | `src/tabs/overview.ts` – `attachPortfolioToggleHandler()` | `src/tabs/overview.ts` – `sanitizePosition()`; `renderPositionsTable()` | Data attributes enabling security detail navigation | Security identifier attached to each row so the detail tab can open the correct snapshot.【F:src/data/updateConfigsWS.ts†L691-L753】【F:src/tabs/overview.ts†L213-L233】【F:src/tabs/overview.ts†L420-L447】 |
| `positions[].name` | string | Same as above | `src/tabs/overview.ts` – `renderPositionsTable()` | Positions table first column | Security display name within the expanded table.【F:src/tabs/overview.ts†L393-L398】 |
| `positions[].current_holdings` | number | Same as above | `src/tabs/overview.ts` – `sanitizePosition()` and `renderPositionsTable()` | Positions table “Bestand” column | Quantity of shares/units held, normalised for display with precision handling.【F:src/tabs/overview.ts†L213-L233】【F:src/tabs/overview.ts†L399-L408】 |
| `positions[].purchase_value` | number (EUR) | Same as above | `src/tabs/overview.ts` – `sanitizePosition()`; `buildPurchasePriceDisplay()` | Positions table “Ø Kaufpreis” column | Average purchase price information shown with currency-aware labelling and aria text.【F:src/tabs/overview.ts†L213-L333】 |
| `positions[].current_value` | number (EUR) | Same as above | `src/tabs/overview.ts` – `sanitizePosition()`; `renderPositionsTable()` | Positions table “Aktueller Wert” column | Current position value in EUR.【F:src/tabs/overview.ts†L213-L233】【F:src/tabs/overview.ts†L403-L410】 |
| `positions[].performance.gain_abs` | number (EUR) | Same as above | `src/tabs/overview.ts` – `sanitizePosition()`; `renderPositionsTable()`; `src/content/elements.ts` – `formatValue()` | Positions table absolute gain column | Gain displayed for each security, falling back to backend performance metrics when needed.【F:src/tabs/overview.ts†L213-L233】【F:src/tabs/overview.ts†L387-L413】【F:src/content/elements.ts†L47-L84】 |
| `positions[].performance.gain_pct` | number (%) | Same as above | Same as above | Positions table percentage column & metadata tooltips | Percentage gain used for cell text, dataset metadata, and colour coding.【F:src/tabs/overview.ts†L213-L333】【F:src/tabs/overview.ts†L387-L485】 |
| `positions[].average_cost.native` / `security` | number (security currency) | `src/tabs/overview.ts` – `attachPortfolioToggleHandler()` | `src/tabs/overview.ts` – `buildPurchasePriceDisplay()` | Purchase price primary value | Average cost per share in the security currency (or native value) shown as the leading figure.【F:src/tabs/overview.ts†L252-L304】 |
| `positions[].average_cost.account` / `eur` | number (account/EUR currency) | Same as above | `src/tabs/overview.ts` – `buildPurchasePriceDisplay()` | Optional secondary purchase price | Average cost converted to the account or EUR currency, surfaced when it differs from the primary price.【F:src/tabs/overview.ts†L252-L333】 |
| `positions[].average_cost.source` | string (`aggregation`/`totals`/`eur_total`) | Same as above | `src/tabs/types.ts` – `AverageCostPayload`; `src/tabs/overview.ts` – `buildPurchasePriceDisplay()` | Tooltip provenance in purchase price cell | Indicates how the average price was derived; informs formatting and tooltips.【F:src/tabs/types.ts†L32-L67】【F:src/tabs/overview.ts†L252-L333】 |
| `positions[].average_cost.coverage_ratio` | number (0–1) | Same as above | `src/tabs/types.ts` – `AverageCostPayload`; `src/tabs/security_detail.ts` – `composeAveragePurchaseTooltip()` | Purchase FX tooltip (security detail) | Coverage ratio displayed in the FX tooltip for the security detail view when available.【F:src/tabs/types.ts†L32-L67】【F:src/tabs/security_detail.ts†L1106-L1178】 |
| `positions[].aggregation.*` | numbers (holdings totals) | Same as above | `src/tabs/overview.ts` – `toHoldingsAggregationPayload()`; `buildPurchasePriceDisplay()` | Purchase price sorting metadata | Aggregated purchase totals (EUR, native, account) used to sort and annotate purchase price cells.【F:src/tabs/overview.ts†L200-L333】 |
| `positions[].security_currency_code` / `security_currency` / `native_currency_code` / `native_currency` | string codes | Same as above | `src/tabs/overview.ts` – `resolveCurrencyFromPosition()` | Purchase price currency selection | Backend-provided currency hints to choose the correct symbol for average purchase prices.【F:src/tabs/overview.ts†L252-L304】 |
| `positions[].account_currency_code` / `account_currency` / `purchase_currency_code` / `currency_code` | string codes | Same as above | `src/tabs/overview.ts` – `resolveCurrencyFromPosition()` | Secondary purchase price currency | Used to determine the label for the account/EUR purchase price line when rendered.【F:src/tabs/overview.ts†L252-L304】 |

## Last file update (`pp_reader/get_last_file_update` command, `last_file_update` push)

| Name | Format | Requested by | Processed in | Displayed in | Description |
| --- | --- | --- | --- | --- | --- |
| `last_file_update` | string (timestamp text) | `src/tabs/overview.ts` – `renderDashboard()` | `src/data/updateConfigsWS.ts` – `handleLastFileUpdate()` | Footer card metadata and header fallback | Human-readable timestamp of the latest portfolio file import shown in the dashboard footer and updated live.【F:src/tabs/overview.ts†L1384-L1472】【F:src/data/updateConfigsWS.ts†L1096-L1139】 |

## Security snapshot (`pp_reader/get_security_snapshot` command)

| Name | Format | Requested by | Processed in | Displayed in | Description |
| --- | --- | --- | --- | --- | --- |
| `snapshot.name` | string | `src/tabs/security_detail.ts` – `renderSecurityDetail()` | `src/tabs/security_detail.ts` – `renderSecurityDetail()` | Security detail header | Security title used for the detail tab header card.【F:src/tabs/security_detail.ts†L1703-L1813】 |
| `snapshot.currency_code` | string (ISO) | Same as above | `src/tabs/security_detail.ts` – pricing helpers (`extractSnapshotLastPriceNative()`, `buildHeaderMeta()`, `composeAveragePurchaseTooltip()`) | Header meta, info bar, FX tooltip | Determines display currency for prices, chart annotations, and FX tooltips.【F:src/tabs/security_detail.ts†L600-L617】【F:src/tabs/security_detail.ts†L1189-L1384】【F:src/tabs/security_detail.ts†L1106-L1178】 |
| `snapshot.total_holdings` / `total_holdings_precise` | number | Same as above | `src/tabs/security_detail.ts` – `buildHeaderMeta()` | Header “Bestand” value | Quantity of units held, favouring precise values when provided.【F:src/tabs/security_detail.ts†L1189-L1378】 |
| `snapshot.last_price_native` / `last_price.native` | number | Same as above | `src/tabs/security_detail.ts` – `extractSnapshotLastPriceNative()`; `buildHeaderMeta()` | “Letzter Preis” value and chart stitching | Latest security price used for display and to extend the price history series.【F:src/tabs/security_detail.ts†L600-L704】【F:src/tabs/security_detail.ts†L1189-L1378】 |
| `snapshot.last_price_eur` | number (EUR) | Same as above | `src/tabs/security_detail.ts` – `extractSnapshotLastPriceNative()`; `buildHeaderMeta()` | Price fallback when instrument currency is EUR | Provides fallback valuation when only EUR pricing is available.【F:src/tabs/security_detail.ts†L600-L617】【F:src/tabs/security_detail.ts†L1189-L1378】 |
| `snapshot.market_value_eur` / `current_value_eur` | number (EUR) | Same as above | `src/tabs/security_detail.ts` – `buildHeaderMeta()` | “Marktwert (EUR)” block | Current market value in EUR, falling back to `current_value_eur` when necessary.【F:src/tabs/security_detail.ts†L1189-L1384】 |
| `snapshot.average_cost.native` / `security` | number | Same as above | `src/tabs/security_detail.ts` – `extractAverageCostPayload()`; `buildHeaderMeta()` | Average purchase price (security currency) | Rendered as the primary average purchase value and baseline for the chart.【F:src/tabs/security_detail.ts†L122-L165】【F:src/tabs/security_detail.ts†L1189-L1378】【F:src/tabs/security_detail.ts†L1543-L1678】 |
| `snapshot.average_cost.account` / `eur` | number | Same as above | `src/tabs/security_detail.ts` – `extractAverageCostPayload()`; `buildHeaderMeta()`; `composeAveragePurchaseTooltip()` | Average purchase price (account/EUR) | Optional secondary value plus FX tooltip information.【F:src/tabs/security_detail.ts†L122-L166】【F:src/tabs/security_detail.ts†L1189-L1378】【F:src/tabs/security_detail.ts†L1106-L1178】 |
| `snapshot.average_cost.source` | string (`aggregation`/`totals`/`eur_total`) | Same as above | `src/tabs/security_detail.ts` – `extractAverageCostPayload()`; `composeAveragePurchaseTooltip()` | FX tooltip metadata | Indicates how the average price was computed, surfaced inside the FX tooltip.【F:src/tabs/security_detail.ts†L122-L166】【F:src/tabs/security_detail.ts†L1106-L1178】 |
| `snapshot.average_cost.coverage_ratio` | number (0–1) | Same as above | `src/tabs/security_detail.ts` – `extractAverageCostPayload()`; `composeAveragePurchaseTooltip()` | FX tooltip coverage percentage | Displays how much of the position is covered by price data.【F:src/tabs/security_detail.ts†L122-L166】【F:src/tabs/security_detail.ts†L1106-L1178】 |
| `snapshot.aggregation.total_holdings` / `positive_holdings` / `purchase_value_eur` / `purchase_total_security` / `purchase_total_account` / `security_currency_total` / `account_currency_total` / `purchase_value_cents` | numbers | Same as above | `src/tabs/security_detail.ts` – `extractAggregationPayload()`; `resolveAccountCurrencyCode()` | FX tooltip currency inference and metadata | Aggregated purchase metrics powering currency inference and tooltip context for the average purchase calculation.【F:src/tabs/security_detail.ts†L169-L227】【F:src/tabs/security_detail.ts†L960-L1018】 |
| `snapshot.performance.gain_abs` / `gain_pct` / `total_change_eur` / `total_change_pct` | numbers | Same as above | `src/utils/performance.ts` – `normalizePerformancePayload()`; `src/tabs/security_detail.ts` – `buildHeaderMeta()` | Day and total gain cards | Gain metrics shown in the security detail meta grid.【F:src/utils/performance.ts†L5-L48】【F:src/tabs/security_detail.ts†L1189-L1378】 |
| `snapshot.performance.day_change.price_change_native` / `price_change_eur` / `change_pct` | numbers | Same as above | `src/utils/performance.ts` – `normalizePerformancePayload()`; `src/tabs/security_detail.ts` – `buildHeaderMeta()` | “Tagesänderung” block | Day change metrics displayed with currency-aware formatting.【F:src/utils/performance.ts†L5-L48】【F:src/tabs/security_detail.ts†L1189-L1378】 |
| `snapshot.performance.day_change.source` / `coverage_ratio` | string / number | Same as above | `src/utils/performance.ts` – `normalizePerformancePayload()` | Tooltip provenance (implicit) | Preserved within the performance payload for potential day-change provenance displays.【F:src/utils/performance.ts†L5-L48】 |
| `snapshot.source` | string (`cache`, etc.) | Same as above | `src/tabs/security_detail.ts` – `renderSecurityDetail()`; `buildCachedSnapshotNotice()` | Cached-data warning card | Marks snapshots originating from cache so the UI can warn about stale data.【F:src/tabs/security_detail.ts†L1703-L1758】【F:src/tabs/security_detail.ts†L232-L270】 |
| `snapshot.purchase_value_eur` | number | Same as above | `src/tabs/security_detail.ts` – `resolveAccountCurrencyCode()` | FX inference logic | Helps determine whether the account currency should be considered EUR for tooltips.【F:src/tabs/security_detail.ts†L960-L1013】 |
| `snapshot.account_currency_code` / `account_currency` | string | Same as above | `src/tabs/security_detail.ts` – `resolveAccountCurrencyCode()` | FX tooltip currency selection | Backend-supplied account currency override used when rendering average purchase details.【F:src/tabs/security_detail.ts†L960-L1010】 |
| `snapshot.purchase_total_security` / `purchase_total_account` | number | Same as above | `src/tabs/security_detail.ts` – `resolveAccountCurrencyCode()` | FX tooltip ratios | Purchase totals utilised to compare account vs. security currency exposure.【F:src/tabs/security_detail.ts†L990-L999】 |
| `snapshot.purchase_fx_date` / `purchase_fx_timestamp` / `purchase_fx_rate_date` / `purchase_fx_rate_timestamp` / `avg_price_updated_at` / `avg_price_timestamp` / `purchase_updated_at` / `purchase_updated` / `purchase_value_updated_at` / `purchase_value_updated` / `last_purchase_date` / `last_purchase_timestamp` / `last_transaction_date` / `last_transaction_at` | string or number timestamps | Same as above | `src/tabs/security_detail.ts` – `resolvePurchaseFxTimestamp()` | FX tooltip “Stand” date | Optional metadata keys inspected to timestamp the FX rate shown in the tooltip.【F:src/tabs/security_detail.ts†L1038-L1082】 |
| `snapshot.last_price_fetched_at` / `last_price_date` / `last_price.fetched_at` | string or number timestamps | Same as above | `src/tabs/security_detail.ts` – `resolvePurchaseFxTimestamp()` | FX tooltip fallback date | Backup timestamp sources when dedicated purchase FX timestamps are unavailable.【F:src/tabs/security_detail.ts†L1067-L1082】 |

## Security history (`pp_reader/get_security_history` command)

| Name | Format | Requested by | Processed in | Displayed in | Description |
| --- | --- | --- | --- | --- | --- |
| `prices[].date` | number (epoch day), ISO string, or Date | `src/tabs/security_detail.ts` – `renderSecurityDetail()` and range switch handler | `src/tabs/security_detail.ts` – `normaliseHistorySeries()`; `buildHistorySeriesWithSnapshotPrice()` | History chart and placeholders | Historical date parsed into JavaScript dates for charting across all range selections.【F:src/tabs/security_detail.ts†L1703-L1846】【F:src/tabs/security_detail.ts†L540-L704】 |
| `prices[].close` | number (native currency) | Same as above | `src/tabs/security_detail.ts` – `normaliseHistorySeries()` | History chart series | Closing price per day plotted in the security detail chart.【F:src/tabs/security_detail.ts†L540-L704】 |
| `prices[].close_raw` | integer price (scaled by 1e8) | Same as above | `src/tabs/security_detail.ts` – `normaliseHistorySeries()` | History chart fallback values | Alternative raw price used when `close` is missing, scaled down before plotting.【F:src/tabs/security_detail.ts†L540-L704】 |

## Push infrastructure (`panels_updated` bus)

| Name | Format | Requested by | Processed in | Displayed in | Description |
| --- | --- | --- | --- | --- | --- |
| `data_type` (`accounts`/`portfolio_values`/`portfolio_positions`/`last_file_update`) | string discriminator | `src/dashboard.ts` – event handler | `src/dashboard.ts` – `normalizeDashboardUpdate()` and `_doRender()` | Delegates to the handlers listed above | Determines which update handler runs for each `panels_updated` event carrying integration data.【F:src/dashboard.ts†L200-L320】【F:src/dashboard.ts†L960-L1039】 |

## Legacy helper

`pp_reader/get_dashboard_data` is still exposed in `src/data/api.ts` for backwards compatibility but the modern dashboard boot flow no longer calls it; the frontend derives its state from the granular endpoints listed above.【F:src/data/api.ts†L160-L198】
